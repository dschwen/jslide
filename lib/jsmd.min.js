var jsmd=(function(){function h(r,s){this.x=r||0;this.y=s||0}h.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};h.prototype.len2=function(){return this.x*this.x+this.y*this.y};h.prototype.pbclen=function(s,u){var t=this.x-Math.round(this.x/s)*s,r=this.y-Math.round(this.y/u)*u;return Math.sqrt(t*t+r*r)};h.prototype.normalize=function(){var r=this.len();if(r===0){this.x=1;this.y=0}else{this.x/=r;this.y/=r}};h.distance=function(s,r){return Math.sqrt((s.x-r.x)*(s.x-r.x)+(s.y-r.y)*(s.y-r.y))};h.distance2=function(s,r){return(s.x-r.x)*(s.x-r.x)+(s.y-r.y)*(s.y-r.y)};h.pbcdistance=function(u,r,t,x){var v=u.x-r.x,s=u.y-r.y;v-=Math.round(v/t)*t;s-=Math.round(s/x)*x;return Math.sqrt(v*v+s*s)};h.pbcdistance2=function(u,r,t,x){var v=u.x-r.x,s=u.y-r.y;v-=Math.round(v/t)*t;s-=Math.round(s/x)*x;return v*v+s*s};h.prototype.wrap=function(r,s){this.x-=Math.floor(this.x/r)*r;this.y-=Math.floor(this.y/s)*s};h.prototype.dwrap=function(r,s){this.x-=Math.round(this.x/r)*r;this.y-=Math.round(this.y/s)*s};h.sub=function(s,r){return new h(s.x-r.x,s.y-r.y)};h.prototype.sub=function(r){this.x-=r.x;this.y-=r.y};h.add=function(s,r){return new h(s.x+r.x,s.y+r.y)};h.prototype.add=function(r){this.x+=r.x;this.y+=r.y};h.scale=function(s,r){return new h(s.x*r,s.y*r)};h.prototype.scale=function(r){this.x*=r;this.y*=r};h.smul=function(s,r){return s.x*r.x+s.y*r.y};h.prototype.smul=function(r){return this.x*r.x+this.y*r.y};h.prototype.proj=function(r){var t=this.smul(r);this.x=r.x*t;this.y=r.y*t};h.prototype.zero=function(){this.x=0;this.y=0};h.prototype.set=function(r){this.x=r.x;this.y=r.y};h.random=function(r,s){return new h(Math.random()*r,Math.random()*s)};function o(r,s){this.p=new h(r,s);this.v=new h(0,0);this.f=new h(0,0);this.t=0}function p(){this.r=3;this.color="rgb(255,0,0)";this.Z=1;this.m=1}function k(s,u,r,t){this.p=[new h(s,u),new h(r,t)];this.n=new h(t-u,s-r);this.n.normalize();this.c=new h(r-s,t-u);this.l=this.c.pbclen();this.c.scale(1/this.l);this.t=0}k.prototype.dist=function(t){var r=new h(this.p[0].x-t.x,this.p[0].y-t.y),u=-(r.x*this.c.x+r.y*this.c.y);if(u<=0){return r}else{if(u>=this.l){return new h(this.p[1].x-t.x,this.p[1].y-t.y)}else{r.proj(this.n);return r}}};function j(r,s){if(r===undefined){return s}for(i in s){if(s.hasOwnProperty(i)){}}}function d(r,t,s){this.atoms=[];this.barriers=[];this.types=[];this.interaction=[];this.w=r;this.h=t;this.canvas={};this.renderChain=[e,b,l];this.lc={};this.nl={dr:0,data:[],count:0};this.dt=0;this.step=0;this.time=0;this.drag=0.995}d.prototype.setInteraction=function(s,u){for(var r=0;r<2;++r){if(this.interaction[s[r]]===undefined){this.interaction[s[r]]=[]}this.interaction[s[r]][s[1-r]]=u}};d.prototype.setCutOff=function(u,t){var v=u+t,s,r;this.rm2=v*v;this.rp=t;this.rc=u;this.rc2=u*u;this.lc.nx=Math.max(3,Math.floor(this.w/v));this.lc.ny=Math.max(3,Math.floor(this.h/v));this.lc.dx=this.w/this.lc.nx;this.lc.dy=this.h/this.lc.ny;r=new Array(this.lc.nx);for(s=0;s<this.lc.nx;++s){r[s]=new Array(this.lc.ny)}this.lc.data=r};d.prototype.clearLinkcell=function(){var s,r;for(s=0;s<this.lc.nx;++s){for(r=0;r<this.lc.ny;++r){this.lc.data[s][r]=[]}}};d.prototype.updateLinkcell=function(){this.clearLinkcell();var t,s,r;for(r=0;r<this.atoms.length;++r){t=Math.floor(this.atoms[r].p.x/this.lc.dx)%this.lc.nx;s=Math.floor(this.atoms[r].p.y/this.lc.dy)%this.lc.ny;this.lc.data[t][s].push(r)}};d.prototype.clearNeighborlist=function(){for(var r=0;r<this.atoms.length;++r){this.nl.data[r]=[]}};d.prototype.updateNeighborlist=function(t){if(t!==undefined){this.nl.dr+=2*t;if(this.nl.dr<this.rp){return}}this.nl.dr=0;this.updateLinkcell();this.clearNeighborlist();var z,y,v,C,x,w,u,A,s,B,r=[[0,1],[1,this.lc.ny-1],[1,0],[1,1]];for(z=0;z<this.lc.nx;++z){for(y=0;y<this.lc.ny;++y){B=this.lc.data[z][y].length;for(x=0;x<B;++x){A=this.lc.data[z][y][x];for(w=x+1;w<B;++w){s=this.lc.data[z][y][w];if(jsmd.Vector.pbcdistance2(this.atoms[A].p,this.atoms[s].p,this.w,this.h)<this.rm2){this.nl.data[A].push(s)}}for(u=0;u<r.length;++u){v=(z+r[u][0])%this.lc.nx;C=(y+r[u][1])%this.lc.ny;for(w=0;w<this.lc.data[v][C].length;++w){s=this.lc.data[v][C][w];if(jsmd.Vector.pbcdistance2(this.atoms[A].p,this.atoms[s].p,this.w,this.h)<this.rm2){this.nl.data[A].push(s)}}}}}}this.nl.count++};d.prototype.updateForces=function(){var u,t,r,v,x,w,s;for(u=0;u<this.atoms.length;++u){this.atoms[u].f.x=0;this.atoms[u].f.y=0}for(u=0;u<this.atoms.length;++u){for(r=0;r<this.nl.data[u].length;++r){t=this.nl.data[u][r];s=jsmd.Vector.sub(this.atoms[t].p,this.atoms[u].p);s.dwrap(this.w,this.h);x=s.len2();if(x<this.rc2){x=Math.sqrt(x);w=this.interaction[this.atoms[u].t][this.atoms[t].t];if(w!==undefined){v=w.call(this,x,[this.atoms[u].t,this.atoms[t].t]);s.scale(v/x);this.atoms[u].f.add(s);this.atoms[t].f.sub(s)}}}}for(u=0;u<this.atoms.length;++u){for(t=0;t<this.barriers.length;++t){s=this.barriers[t].dist(this.atoms[u].p);x=s.pbclen();if(x<this.rc){w=this.interaction[this.atoms[u].t][this.barriers[t].t];if(w!==undefined){v=w.call(this,x,[this.atoms[u].t,this.barriers[t].t]);s.scale(v/x);this.atoms[u].f.add(s)}}}}};d.prototype.velocityVerlet=function(){var s,u=this.dt,r,v,y=0,w=0,t=0,x=new jsmd.Vector();for(s=0;s<this.atoms.length;++s){r=this.types[this.atoms[s].t].m;x.set(this.atoms[s].v);x.scale(u);x.add(jsmd.Vector.scale(this.atoms[s].f,0.5/r*u*u));this.atoms[s].p.add(x);this.atoms[s].p.wrap(this.w,this.h);this.atoms[s].v.add(jsmd.Vector.scale(this.atoms[s].f,0.5/r*u));y=Math.max(y,x.len2())}this.updateNeighborlist(Math.sqrt(y));this.updateForces();for(s=0;s<this.atoms.length;++s){this.atoms[s].v.add(jsmd.Vector.scale(this.atoms[s].f,0.5/r*u));this.atoms[s].v.scale(this.drag);w=Math.max(w,this.atoms[s].v.len2());t=Math.max(t,this.atoms[s].f.len2()/(0.25*r*r))}this.step++;this.time+=u;v=0.025;w=Math.sqrt(w);t=Math.sqrt(t);this.dt=Math.min(0.01,v/w,Math.sqrt(2*v/t))};d.prototype.setCanvas=function(r){this.canvas={node:r,w:r.width,h:r.height,ctx:r.getContext("2d")}};d.prototype.draw=function(){var s=this.canvas.ctx,r;s.setTransform(this.canvas.w/this.w,0,0,this.canvas.h/this.h,0,0);s.fillStyle="rgb(200,200,200)";s.fillRect(0,0,800,500);for(r=0;r<this.renderChain.length;++r){this.renderChain[r].call(this,s)}};function e(z){var s,w,v,u;function t(A,C,B){z.beginPath();z.arc(A,C,B,0,Math.PI*2,true);z.closePath();z.fill()}z.strokeStyle="rgba(0,100,0,0.5)";for(u=0;u<this.atoms.length;++u){z.fillStyle=this.types[this.atoms[u].t].color;s=this.atoms[u].p.x;w=this.atoms[u].p.y;v=this.types[this.atoms[u].t].r;t(s,w,v);if(s<=v||w<=v||s+v>this.w||w+v>this.h){if(s<=v){t(s+this.w,w,v)}if(w<=v){t(s,w+this.h,v)}if(s<=v&&w<=v){t(s+this.w,w+this.h,v)}if(s+v>this.w){t(s-this.w,w,v)}if(w+v>this.h){t(s,w-this.h,v)}if(s+v>this.w&&w+v>this.h){t(s-this.w,w-this.h,v)}}}}function l(s){var r;s.strokeStyle="rgba(0,0,100,1)";for(r=0;r<this.barriers.length;++r){s.beginPath();s.moveTo(this.barriers[r].p[0].x,this.barriers[r].p[0].y);s.lineTo(this.barriers[r].p[1].x,this.barriers[r].p[1].y);s.closePath();s.stroke()}}function b(s){var r;s.strokeStyle="rgba(0,100,0,0.5)";s.lineWidth=0.01;for(r=0;r<this.atoms.length;++r){s.beginPath();s.moveTo(this.atoms[r].p.x,this.atoms[r].p.y);s.lineTo(this.atoms[r].p.x+this.atoms[r].f.x*0.01,this.atoms[r].p.y+this.atoms[r].f.y*0.01);s.closePath();s.stroke()}}function n(u,t){var w=t!==undefined?t:10,v=u!==undefined?u:1,r=Math.pow(v,6),s=r*r;return function(x){x/=4;return 12*w*(r*Math.pow(x,-7)-s*Math.pow(x,-13))}}function q(t,w,v){var u=t!==undefined?t:1.5,s=w!==undefined?w:2,r=v!==undefined?v:1;return function(y){var x=Math.exp(-s*(y-u));return 2*s*r*(1-x)*x}}function a(v,u,y){var x=u!==undefined?u:0.01,t=y!==undefined?y:10,w=t/x,s=[],r;for(r=0;r<=w*t+10;++r){s[r]=v.call(this,r/w)}return function(A){A*=w;var z=Math.floor(A);A-=z;return(1-A)*s[z]+A*s[z+1]}}function g(s,r){var t=r!==undefined?r:0.0001;return function(u){return 0.5*(s.call(this,u+t)-s.call(this,u-t))/t}}function c(r,s){}function m(r,u,t,s){}function f(x,w){var s=0.539177,C=0.8854*s/(Math.pow(x,0.23)+Math.pow(w,0.23)),y=1,z=1,u=1/(4*Math.PI*z)*x*w*y*y,t=[0.1818,0.5099,0.2802,0.02817],r=[-3.2,-0.9423,-0.4029,-0.2016];function v(D){var B=0,A;for(A=0;A<4;++A){B+=t[A]*Math.exp(r[A]*D/C)}return u/D*B}return v}return{Atom:o,AtomType:p,Barrier:k,Simulation:d,Vector:h,render:{atoms:e,barriers:l,forces:b},force:{lennardJones:n,morse:q,tabulated:a,diff:g},energy:{ZBL:f}}})();